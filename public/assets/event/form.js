(function(){$(function(){$("form .mod-event").length&&($(".mod-event button:button.add-date").click(function(){$(".mod-event dd.dates").length<Event_Form.maxTermForm&&Event_Form.cloneTermForm()}),$(".mod-event button:button.clear").click(function(){var t,e;e=$(this).parent("dd").find(".start").val(),t=$(this).parent("dd").find(".close").val(),""!==e||""!==t?confirm(Event_Form.deleteMessage)&&Event_Form.clearTermForm($(this).parent("dd")):Event_Form.clearTermForm($(this).parent("dd"))}),$("form").submit(function(){var t,e,n,a,r,d;for(d=$(".mod-event dd.dates"),e=[],n=0,a=d.length;a>n;n++)r=d[n],t=Event_Form.termToDates($(r).find(".start").val(),$(r).find(".close").val()),e=e.concat(t);$(".mod-event .event-dates").val(Event_Form.datesToString(e))}),Event_Form.setStoredDates())}),this.Event_Form=function(){function t(){}return t.maxTermForm=10,t.deleteMessage="\u30a4\u30d9\u30f3\u30c8\u65e5\u3092\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",t.dateToString=function(t){var e,n,a;return a=t.getYear(),n=t.getMonth()+1,e=t.getDate(),2e3>a&&(a+=1900),10>n&&(n="0"+n),10>e&&(e="0"+e),a+"/"+n+"/"+e},t.datesToString=function(t){var e,n,a,r,d,o,i,s;for(s=[],a=0,d=t.length;d>a;a++){for(e=t[a],n=0;n<s.length&&this.dateToString(e)!==this.dateToString(s[n]);)n++;n===s.length&&s.push(e)}for(t=s,t.sort(function(t,e){return t-e}),i="",r=0,o=t.length;o>r;r++)e=t[r],i+=this.dateToString(e),i+="\r\n";return i},t.isValidDate=function(t){return"[object Date]"!==Object.prototype.toString.call(t)?!1:!isNaN(t.getTime())&&t.getYear()>0?!0:!1},t.termToDates=function(t,e){var n,a,r,d;if(d=new Date(t),n=new Date(e),r=[],this.isValidDate(d)&&this.isValidDate(n))for(a=new Date(d);n>=a;)r.push(new Date(a)),a.setDate(a.getDate()+1);else this.isValidDate(d)?r.push(new Date(d)):this.isValidDate(n)&&r.push(new Date(n));return r},t.datesToTerm=function(t){var e,n,a,r,d,o,i;for(o=[],d=[],n=a=0,r=t.length;r>a;n=++a)e=t[n],d.push(e),i=new Date(e),i.setDate(i.getDate()+1),n+1<t.length&&this.dateToString(t[n+1])!==this.dateToString(i)&&(o.push([d[0],d[d.length-1]]),d=[]);return d.length>=1&&o.push([d[0],d[d.length-1]]),o},t.setStoredDates=function(){var t,e,n,a,r,d,o,i,s,l,m,v;for(l=$(".mod-event .event-dates").val().split(/\r\n|\n/),n=[],r=0,o=l.length;o>r;r++)t=l[r],e=new Date(t),this.isValidDate(e)&&n.push(e);for(v=this.datesToTerm(n),s=[],a=d=0,i=v.length;i>d;a=++d)m=v[a],0!==a&&this.cloneTermForm(),$(".mod-event dd.dates:last").find(".start").val(this.dateToString(m[0])),s.push($(".mod-event dd.dates:last").find(".close").val(this.dateToString(m[1])));return s},t.cloneTermForm=function(){var e;return e=$(".mod-event dd.dates:last").clone(!1).insertAfter($(".mod-event dd.dates:last")),e.find(".start").val(""),e.find(".close").val(""),e.find(".clear").click(function(){var e,n;n=$(this).parent("dd").find(".start").val(),e=$(this).parent("dd").find(".close").val(),""!==n||""!==e?confirm(t.deleteMessage)&&t.clearTermForm($(this).parent("dd")):t.clearTermForm($(this).parent("dd"))}),$(".mod-event .date").attr("id","").datetimepicker({lang:"ja",timepicker:!1,format:"Y/m/d"}),$(".mod-event dd.dates").length>=this.maxTermForm?$(".mod-event button:button.add-date").attr("disabled",!0):void 0},t.clearTermForm=function(t){return t.find(".start").val(""),t.find(".close").val(""),$(".mod-event dd.dates").length>1&&t.remove(),$(".mod-event dd.dates").length<this.maxTermForm?$(".mod-event button:button.add-date").removeAttr("disabled"):void 0},t}()}).call(this);